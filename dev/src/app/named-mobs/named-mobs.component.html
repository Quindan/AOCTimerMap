<div class="named-mobs-container">
  <div class="header">
    <h2>üèÜ Named Mob Timers</h2>
    <p>Track respawn timers for named mobs from <a href="https://ashescodex.com" target="_blank">Ashes Codex</a></p>
  </div>

  <!-- Filters and Controls -->
  <div class="controls">
    <div class="filter-group">
      <label for="search">Search:</label>
      <input 
        id="search"
        type="text" 
        [(ngModel)]="searchQuery" 
        (input)="onSearchChange()"
        placeholder="Search named mobs..."
        class="search-input">
    </div>

    <div class="filter-group">
      <label for="level">Level:</label>
      <select id="level" [(ngModel)]="selectedLevel" (change)="onLevelChange()" class="level-select">
        <option [value]="null">All Levels</option>
        <option *ngFor="let level of levelOptions" [value]="level">{{level}}</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="server">Server:</label>
      <input 
        id="server"
        type="text" 
        [(ngModel)]="selectedServer" 
        (change)="loadActiveTimers()"
        placeholder="default"
        class="server-input">
    </div>

    <div class="filter-group">
      <label class="checkbox-label">
        <input 
          type="checkbox" 
          [(ngModel)]="showOnlyActive" 
          (change)="onShowActiveChange()">
        Show only active timers
      </label>
    </div>

    <div class="filter-group">
      <button (click)="importNamedMobs()" [disabled]="loading" class="import-btn">
        {{loading ? 'Importing...' : 'Import Mobs'}}
      </button>
    </div>
  </div>

  <!-- Active Timers Section -->
  <div class="timers-section" *ngIf="activeTimers.length > 0">
    <h3>üïê Active Timers ({{activeTimers.length}})</h3>
    <div class="timers-grid">
      <div 
        *ngFor="let timer of activeTimers" 
        class="timer-card"
        [ngClass]="getTimerStatusClass(timer)">
        
        <div class="timer-header">
          <h4 class="mob-name">{{timer.mob_name}}</h4>
          <span class="level-badge" [ngClass]="getLevelClass(timer.level || 1)">
            Lv.{{timer.level || '?'}}
          </span>
        </div>

        <div class="timer-info">
          <div class="countdown">
            <span class="time">{{formatTimeRemaining(timer)}}</span>
            <span class="status">{{getTimerStatus(timer)}}</span>
          </div>
          
          <div class="timer-details">
            <div *ngIf="timer.player_name" class="player">
              <strong>Killed by:</strong> {{timer.player_name}}
            </div>
            <div class="killed-at">
              <strong>Killed:</strong> {{timer.last_killed_at | date:'short'}}
            </div>
            <div class="respawn-at">
              <strong>Respawns:</strong> {{timer.respawn_at | date:'short'}}
            </div>
            <div *ngIf="timer.notes" class="notes">
              <strong>Notes:</strong> {{timer.notes}}
            </div>
          </div>
        </div>

        <div class="timer-actions">
          <button 
            (click)="openCodexLink(timer)" 
            class="codex-btn"
            title="View on Ashes Codex">
            üìñ Codex
          </button>
          <button 
            (click)="deleteTimer(timer)" 
            class="delete-btn"
            title="Delete Timer">
            üóëÔ∏è Delete
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Named Mobs List -->
  <div class="mobs-section">
    <h3>üìã Named Mobs ({{filteredMobs.length}})</h3>
    
    <div *ngIf="loading" class="loading">
      Loading named mobs...
    </div>

    <div *ngIf="!loading && filteredMobs.length === 0" class="no-results">
      No named mobs found matching your criteria.
    </div>

    <div class="mobs-grid" *ngIf="!loading && filteredMobs.length > 0">
      <div 
        *ngFor="let mob of filteredMobs" 
        class="mob-card">
        
        <div class="mob-header">
          <h4 class="mob-name">{{mob.name}}</h4>
          <span class="level-badge" [ngClass]="getLevelClass(mob.level)">
            Lv.{{mob.level}}
          </span>
        </div>

        <div class="mob-info">
          <div class="respawn-time">
            <strong>Respawn:</strong> {{mob.respawn_minutes}}min
          </div>
          <div *ngIf="mob.location_x && mob.location_y" class="location">
            <strong>Location:</strong> 
            {{mob.location_x | number:'1.0-0'}}, {{mob.location_y | number:'1.0-0'}}
          </div>
        </div>

        <div class="mob-actions">
          <button 
            (click)="startTimer(mob)" 
            class="start-timer-btn"
            title="Start Timer">
            ‚è±Ô∏è Start Timer
          </button>
          <button 
            (click)="openCodexLink(mob)" 
            class="codex-btn"
            title="View on Ashes Codex">
            üìñ Codex
          </button>
        </div>

        <!-- Show active timer for this mob if exists -->
        <div 
          *ngIf="getActiveTimerForMob(mob.id)" 
          class="active-timer-indicator">
          <div class="timer-status">
            üïê {{formatTimeRemaining(getActiveTimerForMob(mob.id)!)}}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

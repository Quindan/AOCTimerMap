server {
    listen 80;
    server_name _;
    
    # Basic Auth
    auth_basic "InvictaWeb Access";
    auth_basic_user_file /etc/nginx/.htpasswd;

    # Document root
    root /var/www/html;
    index index.html;

    # Handle static files first - NO CACHE for development
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        add_header Cache-Control "no-cache, no-store, must-revalidate" always;
        add_header Pragma "no-cache" always;
        add_header Expires "0" always;
        try_files $uri =404;
    }

    # Named mobs API with path info
    location ~ ^/named_mobs_api\.php(/.*)?$ {
        fastcgi_pass 127.0.0.1:9000;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root/named_mobs_api.php;
        fastcgi_param PATH_INFO $1;
    }

    # Regular PHP files
    location ~ \.php$ {
        fastcgi_pass 127.0.0.1:9000;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }

    # Map application
    location /map/ {
        try_files $uri $uri/ /map/index.html;
    }

    # Guides/Wiki application
    location /guides/ {
        try_files $uri $uri/ /guides/index.html;
    }

    # Documentation files
    location /docs/ {
        try_files $uri $uri/ =404;
        
        # Set proper MIME type for markdown files
        location ~* \.md$ {
            add_header Content-Type text/plain;
        }
    }

    # Root landing page - handled by index.html redirect

    # Everything else - no cache for development
    location / {
        add_header Cache-Control "no-cache, no-store, must-revalidate" always;
        add_header Pragma "no-cache" always;
        add_header Expires "0" always;
        try_files $uri $uri/ =404;
    }
}
